{
    "EmergencyReportAction": [
        {
            "parentClass": "EmergencyReportAction",
            "name": "EmergencyReportAction",
            "sourceCode": "public EmergencyReportAction(DAOFactory factory, long loggedInMID, String pidString) throws iTrustException {\r\n\t\tsuper(factory, pidString);\r\n\t\tthis.patientDAO = factory.getPatientDAO();\r\n\t\tthis.allergyDAO = factory.getAllergyDAO();\r\n\t\tthis.transDAO = factory.getTransactionDAO();\r\n\t\tthis.ovDAO = factory.getOfficeVisitDAO();\r\n\t\tthis.loggedInMID = loggedInMID;\r\n\t\temailutil = new EmailUtil(factory);\r\n\t\t\r\n\t\tpb = patientDAO.getPatient(this.pid);\r\n\t\ttransDAO.logTransaction(TransactionType.VIEW_EMERGENCY_REPORT, this.loggedInMID, Long.valueOf(pidString), \"viewed emergency report\");\r\n\t\temailutil.sendEmail(makeEmail());\r\n\t}"
        },
        {
            "parentClass": "EmergencyReportAction",
            "name": "getPatientName",
            "sourceCode": "public String getPatientName() {\r\n\t\treturn (pb.getFirstName() + \" \" + pb.getLastName());\r\n\t}"
        },
        {
            "parentClass": "EmergencyReportAction",
            "name": "getPatientAge",
            "sourceCode": "public String getPatientAge() {\r\n\t\treturn Integer.toString(pb.getAge());\r\n\t}"
        },
        {
            "parentClass": "EmergencyReportAction",
            "name": "getPatientGender",
            "sourceCode": "public String getPatientGender() {\r\n\t\treturn pb.getGender().toString();\r\n\t}"
        },
        {
            "parentClass": "EmergencyReportAction",
            "name": "getPatientEmergencyContact",
            "sourceCode": "public String getPatientEmergencyContact() {\r\n\t\treturn pb.getEmergencyName() + \" \" + pb.getEmergencyPhone();\r\n\t}"
        },
        {
            "parentClass": "EmergencyReportAction",
            "name": "getBloodType",
            "sourceCode": "public String getBloodType() {\r\n\t\treturn pb.getBloodType() + \"\";\r\n\t}"
        },
        {
            "parentClass": "EmergencyReportAction",
            "name": "getAllergies",
            "sourceCode": "public List<AllergyBean> getAllergies() throws iTrustException {\r\n\t\treturn allergyDAO.getAllergies(this.pid);\r\n\t}"
        },
        {
            "parentClass": "EmergencyReportAction",
            "name": "getCurrentPrescriptions",
            "sourceCode": "public List<PrescriptionBean> getCurrentPrescriptions() throws iTrustException {\r\n\t\tList<PrescriptionBean> allPrescriptions = patientDAO.getCurrentPrescriptions(this.pid);\r\n\t\tArrayList<PrescriptionBean> warningList = new ArrayList<PrescriptionBean>();\r\n\t\tfor (int i = 0; i < allPrescriptions.size(); i++) {\r\n\t\t\tif (PrescriptionAlerts.isAlert(allPrescriptions.get(i).getMedication().getNDCode()))\r\n\t\t\t\twarningList.add(allPrescriptions.get(i));\r\n\t\t}\r\n\t\treturn warningList;\r\n\t}"
        },
        {
            "parentClass": "EmergencyReportAction",
            "name": "getWarningDiagnoses",
            "sourceCode": "public List<DiagnosisBean> getWarningDiagnoses() throws iTrustException {\r\n\t\ttry {\r\n\t\t\tboolean dup = false;\r\n\t\t\tList<DiagnosisBean> allDiagnoses = patientDAO.getDiagnoses(this.pid);\r\n\t\t\tArrayList<DiagnosisBean> warningList = new ArrayList<DiagnosisBean>();\r\n\t\t\tfor (DiagnosisBean bean: allDiagnoses) {\r\n\t\t\t\tOfficeVisitBean ovb = ovDAO.getOfficeVisit(bean.getVisitID());\r\n\r\n\t\t\t\tif(ovb == null){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\tif (\"yes\".equals(bean.getClassification()) || (ovb.getVisitDate().getTime() > Calendar.getInstance().getTimeInMillis() - 30 * 24 * 60 * 60 * 1000))  {\r\n\t\t\t\t\tfor (DiagnosisBean wbean: warningList) {\r\n\t\t\t\t\t\tif (bean.getDescription().equals(wbean.getDescription())) {\r\n\t\t\t\t\t\t\tdup = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!dup) {\r\n\t\t\t\t\t\twarningList.add(bean);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn warningList;\r\n\t\t} catch (DBException dbe) {\r\n\t\t\tthrow new iTrustException(dbe.getMessage());\r\n\t\t}\r\n\t}"
        },
        {
            "parentClass": "EmergencyReportAction",
            "name": "getImmunizations",
            "sourceCode": "public List<ProcedureBean> getImmunizations() throws iTrustException {\r\n\t\tList<ProcedureBean> allImmunizations = patientDAO.getImmunizationProcedures(this.pid);\r\n\t\treturn allImmunizations;\r\n\t}"
        },
        {
            "parentClass": "EmergencyReportAction",
            "name": "makeEmail",
            "sourceCode": "private Email makeEmail() throws DBException{\r\n\r\n\t\tEmail email = new Email();\r\n\t\tList<PatientBean> reps = patientDAO.getRepresenting(pb.getMID());\r\n\t\t\r\n\t\tList<String> toAddrs = new ArrayList<String>();\r\n\t\ttoAddrs.add(pb.getEmail());\r\n\t\tfor (PatientBean r: reps) {\r\n\t\t\ttoAddrs.add(r.getEmail());\r\n\t\t}\r\n\t\t\r\n\t\temail.setFrom(\"no-reply@itrust.com\");\r\n    \temail.setToList(toAddrs); // patient and personal representative\r\n    \temail.setSubject(String.format(\"Emergency Report Viewed Notification\"));\r\n    \temail.setBody(\"Dear \" + pb.getFullName() + \",\\n An emergency report has been generated. \" + \r\n    \t\t\t\"Please login to iTrust to see who has viewed your records.\");\r\n\t\treturn email;\r\n\t}"
        }
    ]
}