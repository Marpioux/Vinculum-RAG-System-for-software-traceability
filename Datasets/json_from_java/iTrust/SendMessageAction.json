{
    "SendMessageAction": [
        {
            "parentClass": "SendMessageAction",
            "name": "SendMessageAction",
            "sourceCode": "public SendMessageAction(DAOFactory factory, long loggedInMID) {\r\n\t\tthis.loggedInMID = loggedInMID;\r\n\t\tthis.patientDAO = factory.getPatientDAO();\r\n\t\tthis.personnelDAO = factory.getPersonnelDAO();\r\n\t\tthis.emailer = new EmailUtil(factory);\r\n\t\tthis.messageDAO = factory.getMessageDAO();\r\n\t\tthis.transactionDAO = factory.getTransactionDAO();\r\n\t\tthis.emailVal = new EMailValidator();\r\n\t\tthis.messVal = new MessageValidator();\r\n\t}"
        },
        {
            "parentClass": "SendMessageAction",
            "name": "sendMessage",
            "sourceCode": "public void sendMessage(MessageBean mBean) throws iTrustException, SQLException, FormValidationException {\r\n\t\tmessVal.validate(mBean);\r\n\t\temailVal.validate(mBean);\r\n\t\tmessageDAO.addMessage(mBean);\r\n\t\t\r\n\t\tEmail email = new Email();\r\n\t\tString senderName;\r\n\t\tString fromEmail;\r\n\t\temail.setFrom(\"noreply@itrust.com\");\r\n\t\tList<String> toList = new ArrayList<String>();\r\n\t\tif (8999999999L < mBean.getFrom() && 8999999999L < mBean.getTo()){\r\n\t\t\tPersonnelBean sender = personnelDAO.getPersonnel(loggedInMID);\r\n\t\t\tPersonnelBean receiver = personnelDAO.getPersonnel(mBean.getTo());\r\n\t\t\t\r\n\t\t\ttoList.add(receiver.getEmail());\r\n\t\t\tsenderName = sender.getFullName();\r\n\t\t\tfromEmail = sender.getEmail();\r\n\t\t}else{\r\n\t\t\tif (6999999999L < mBean.getFrom()) {\r\n\t\t\t\tPersonnelBean sender = personnelDAO.getPersonnel(loggedInMID);\r\n\t\t\t\t\r\n\t\t\t\tif (6999999999L < mBean.getTo()) {\r\n\t\t\t\t\tPersonnelBean receiver = personnelDAO.getPersonnel(mBean.getTo());\r\n\t\t\t\t\ttoList.add(receiver.getEmail());\r\n\t\t\t\t} else {\r\n\t\t\t\t\tPatientBean receiver = patientDAO.getPatient(mBean.getTo());\r\n\t\t\t\t\ttoList.add(receiver.getEmail());\r\n\t\t\t\t}\r\n\t\t\t\tsenderName = sender.getFullName();\r\n\t\t\t\tfromEmail = sender.getEmail();\r\n\t\t\t\t\r\n\t\t\t} else {\r\n\t\t\t\tPatientBean sender = patientDAO.getPatient(loggedInMID);\r\n\t\t\t\t\r\n\t\t\t\tif (6999999999L < mBean.getTo()) {\r\n\t\t\t\t\tPersonnelBean receiver = personnelDAO.getPersonnel(mBean.getTo());\r\n\t\t\t\t\ttoList.add(receiver.getEmail());\r\n\t\t\t\t} else {\r\n\t\t\t\t\tPatientBean receiver = patientDAO.getPatient(mBean.getTo());\r\n\t\t\t\t\ttoList.add(receiver.getEmail());\r\n\t\t\t\t}\r\n\t\t\t\tsenderName = sender.getFullName();\r\n\t\t\t\tfromEmail = sender.getEmail();\r\n\t\t\t}\r\n\t\t}\r\n\t\temail.setToList(toList);\r\n\t\temail.setFrom(fromEmail);\r\n\t\temail.setSubject(String.format(\"A new message from %s\", senderName));\r\n\t\temail.setBody(String.format(\"You have received a new message from %s in iTrust. To view it, log in to iTrust and go to \\\"View My Messages\\\"\", senderName));\r\n\t\temailer.sendEmail(email);\r\n\t\t\r\n\t\ttransactionDAO.logTransaction(TransactionType.SEND_MESSAGE, loggedInMID);\r\n\t}"
        },
        {
            "parentClass": "SendMessageAction",
            "name": "getPatientName",
            "sourceCode": "public String getPatientName(long mid) throws iTrustException {\r\n\t\treturn patientDAO.getName(mid);\r\n\t}"
        },
        {
            "parentClass": "SendMessageAction",
            "name": "getPersonnelName",
            "sourceCode": "public String getPersonnelName(long mid) throws iTrustException {\r\n\t\treturn personnelDAO.getName(mid);\r\n\t}"
        },
        {
            "parentClass": "SendMessageAction",
            "name": "getMyRepresentees",
            "sourceCode": "public List<PatientBean> getMyRepresentees() throws iTrustException {\r\n\t\tList<PatientBean> representees = new ArrayList<PatientBean>();\r\n\t\ttry {\r\n\t\t\trepresentees = patientDAO.getRepresented(loggedInMID);\r\n\t\t} catch (DBException e) {\r\n\t\t\te.printStackTrace();\r\n\t\t}\r\n\t\treturn representees;\r\n\t}"
        },
        {
            "parentClass": "SendMessageAction",
            "name": "getMyDLHCPs",
            "sourceCode": "public List<PersonnelBean> getMyDLHCPs() throws iTrustException {\r\n\t\treturn getDLHCPsFor(loggedInMID);\r\n\t}"
        },
        {
            "parentClass": "SendMessageAction",
            "name": "getDLHCPsFor",
            "sourceCode": "public List<PersonnelBean> getDLHCPsFor(long pid) throws iTrustException {\r\n\t\tList<PersonnelBean> dlhcps = new ArrayList<PersonnelBean>();\r\n\t\ttry {\r\n\t\t\tdlhcps = patientDAO.getDeclaredHCPs(pid);\r\n\t\t} catch (DBException e) {\r\n\t\t\te.printStackTrace();\r\n\t\t}\r\n\t\treturn dlhcps;\t\t\r\n\t}"
        }
    ]
}